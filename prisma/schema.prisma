datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum SubscriptionType {
  FREE
  M1
  M3
  M6
  M12
}

model User {
  id          Int           @id @default(autoincrement())
  telegramId  String
  chatId      String
  accountName String?
  balance     Int           @default(0) // —Ä—É–±–ª–∏, —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  subscriptions Subscription[]
  topUps         TopUp[]

  @@unique([telegramId, chatId], name: "telegramId_chatId")
  @@index([telegramId])
  @@index([chatId])
}

model Subscription {
  id              Int              @id @default(autoincrement())
  type            SubscriptionType
  startDate       DateTime         @default(now())
  endDate         DateTime?
  userId          Int
  user            User             @relation(fields: [userId], references: [id])
  subscriptionUrl String?          // üî• –Ω–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞

  @@index([userId])
  @@index([type, startDate])
}


model TopUp {
  id         Int      @id @default(autoincrement())
  userId     Int
  user       User     @relation(fields: [userId], references: [id])
  amount     Int
  status     String   @default("PENDING") // PENDING | SUCCESS | FAILED | TIMEOUT
  orderId    String   @unique              // –≤–Ω–µ—à–Ω–∏–π/–Ω–∞—à –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞
  billId     String?                       // id —Å—á–µ—Ç–∞ –≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–µ
  credited   Boolean  @default(false)      // ‚úÖ –∑–∞—á–∏—Å–ª–µ–Ω–æ –Ω–∞ –±–∞–ª–∞–Ω—Å?
  creditedAt DateTime?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([userId, createdAt])
}


